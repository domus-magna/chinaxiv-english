<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Advanced Search - ChinaXiv Translations</title>
    <meta name="description" content="Advanced search for machine-translated preprints from ChinaXiv (Chinese arXiv)" />
    <link rel="stylesheet" href="../assets/style.css?v=1759990482" />
    <script>
      window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] } };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>
    <script src="../assets/pako.min.js?v=1759990482"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <div class="header-main">
          <a href="../" class="brand">ChinaXiv Translations</a>
          <div class="header-search">
            <input type="text" id="header-search-input" placeholder="Search papers..." />
            <button id="header-search-btn">Search</button>
          </div>
          <a href="../donation.html" class="donate-btn">Donate</a>
        </div>
        
        <div class="header-breadcrumbs">
          <a href="../">Home</a> <span class="sep">&gt;</span> Advanced Search
        </div>
      </div>
    </header>
    <main class="container">
      
      <div class="page-header">
        <h1>Advanced Search</h1>
        <p class="page-description">
          Search through our collection of machine-translated Chinese academic papers with advanced filters and options.
        </p>
      </div>

      <div class="search-block">
        <div class="search-input-group">
          <input type="text" id="search-input" placeholder="Enter search terms..." />
          <button class="search-btn" onclick="performAdvancedSearch()">Search</button>
        </div>
        
        <div class="search-filters">
          <div class="filter-group">
            <label for="category-filter">Category</label>
            <select id="category-filter">
              <option value="">All Categories</option>
              <option value="cs">Computer Science</option>
              <option value="math">Mathematics</option>
              <option value="physics">Physics</option>
              <option value="biology">Biology</option>
              <option value="chemistry">Chemistry</option>
              <option value="engineering">Engineering</option>
              <option value="medicine">Medicine</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label for="date-filter">Date Range</label>
            <select id="date-filter">
              <option value="">All Time</option>
              <option value="week">Past Week</option>
              <option value="month">Past Month</option>
              <option value="quarter">Past 3 Months</option>
              <option value="year">Past Year</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label for="sort-filter">Sort By</label>
            <select id="sort-filter">
              <option value="relevance">Relevance</option>
              <option value="date-desc">Date (Newest)</option>
              <option value="date-asc">Date (Oldest)</option>
              <option value="title">Title (A-Z)</option>
              <option value="author">Author (A-Z)</option>
            </select>
          </div>
        </div>
      </div>

      <div id="search-results">
        <div class="search-help">
          <h3>Search Tips</h3>
          <ul>
            <li>Use <strong>quotes</strong> for exact phrases: "machine learning"</li>
            <li>Use <strong>AND</strong> to combine terms: neural AND network</li>
            <li>Use <strong>OR</strong> to find alternatives: deep OR convolutional</li>
            <li>Use <strong>NOT</strong> to exclude terms: AI NOT artificial</li>
            <li>Search in specific fields: <code>title:optimization</code> or <code>author:smith</code></li>
          </ul>
        </div>
      </div>

    </main>
    <footer class="site-footer">
      <div class="container">
        <div class="footer-content">
          <div class="footer-section">
            <h4>Browse</h4>
            <div class="footer-links">
              <a href="../">Recent Papers</a>
              <a href="../?category=cs">Computer Science</a>
              <a href="../?category=math">Mathematics</a>
              <a href="../?category=physics">Physics</a>
              <a href="../?category=biology">Biology</a>
              <a href="../?category=chemistry">Chemistry</a>
            </div>
          </div>
          <div class="footer-section">
            <h4>Tools</h4>
            <div class="footer-links">
              <a href="./">Advanced Search</a>
              <a href="../browse">Browse All</a>
              <a href="../stats">Statistics</a>
              <a href="../api">API</a>
            </div>
          </div>
          <div class="footer-section">
            <h4>About</h4>
            <p class="footer-description">
              Translations from <a href="https://www.chinaxiv.org" target="_blank" rel="noopener">ChinaXiv</a>.
              All content is machine-translated and should be verified with the original source.
            </p>
          </div>
          <div class="footer-section">
            <h4>Project</h4>
            <p class="footer-meta">
              Last updated: 2025-10-05<br>
              <a href="https://github.com/seconds-0/chinaxiv-english" target="_blank" rel="noopener">Source Code</a><br>
              <a href="../donation.html">Support Us</a><br>
              <a href="../help">Help</a><br>
              <a href="../contact">Contact</a>
            </p>
          </div>
        </div>
      </div>
    </footer>
    <script src="../assets/site.js?v=1759990482"></script>
    <script>
      // Advanced search functionality
      let searchIndex = [];
      
      // Load search index
      fetch('../search-index.json.gz')
        .then(r => {
          if (r.ok) {
            return r.arrayBuffer().then(buf => {
              const decompressed = pako.inflate(new Uint8Array(buf), { to: 'string' });
              return JSON.parse(decompressed);
            });
          } else {
            return fetch('../search-index.json').then(r => r.json());
          }
        })
        .then(data => {
          searchIndex = data;
        })
        .catch(() => {
          fetch('../search-index.json').then(r => r.json()).then(data => {
            searchIndex = data;
          }).catch(() => {});
        });
      
      function performAdvancedSearch() {
        const query = document.getElementById('search-input').value.trim();
        const category = document.getElementById('category-filter').value;
        const dateRange = document.getElementById('date-filter').value;
        const sortBy = document.getElementById('sort-filter').value;
        
        if (!query) {
          document.getElementById('search-results').innerHTML = '<div class="search-help"><h3>Enter search terms to begin</h3><p>Use the search box above to find papers in our collection.</p></div>';
          return;
        }
        
        let results = searchIndex.filter(item => {
          const searchText = [item.title, item.authors, item.abstract, item.subjects].join(' ').toLowerCase();
          const queryLower = query.toLowerCase();
          
          // Basic text search
          if (!searchText.includes(queryLower)) return false;
          
          // Category filter
          if (category && !item.subjects.toLowerCase().includes(category)) return false;
          
          // Date filter
          if (dateRange && item.date) {
            const itemDate = new Date(item.date);
            const now = new Date();
            const daysDiff = (now - itemDate) / (1000 * 60 * 60 * 24);
            
            switch (dateRange) {
              case 'week': if (daysDiff > 7) return false; break;
              case 'month': if (daysDiff > 30) return false; break;
              case 'quarter': if (daysDiff > 90) return false; break;
              case 'year': if (daysDiff > 365) return false; break;
            }
          }
          
          return true;
        });
        
        // Sort results
        switch (sortBy) {
          case 'date-desc':
            results.sort((a, b) => new Date(b.date) - new Date(a.date));
            break;
          case 'date-asc':
            results.sort((a, b) => new Date(a.date) - new Date(b.date));
            break;
          case 'title':
            results.sort((a, b) => (a.title || '').localeCompare(b.title || ''));
            break;
          case 'author':
            results.sort((a, b) => (a.authors || '').localeCompare(b.authors || ''));
            break;
          // Default: relevance (keep original order)
        }
        
        displayResults(results, query);
      }
      
      function displayResults(results, query) {
        const resultsContainer = document.getElementById('search-results');
        
        if (results.length === 0) {
          resultsContainer.innerHTML = `
            <div class="search-help">
              <h3>No results found</h3>
              <p>No papers matched your search criteria. Try:</p>
              <ul>
                <li>Using different keywords</li>
                <li>Removing filters</li>
                <li>Checking spelling</li>
                <li>Using broader terms</li>
              </ul>
            </div>
          `;
          return;
        }
        
        const resultsHtml = `
          <div class="search-results-header">
            <h3>Found ${results.length} result${results.length !== 1 ? 's' : ''} for "${query}"</h3>
          </div>
          <div class="results-list">
            ${results.map(item => `
              <div class="search-result-item">
                <div class="result-title">
                  <a href="../items/${item.id}/">${escapeHtml(item.title || '')}</a>
                </div>
                <div class="result-meta">
                  ${item.date || ''} — ${escapeHtml(item.authors || '')}
                </div>
                <div class="result-abstract">
                  ${escapeHtml((item.abstract || '').slice(0, 280))}…
                </div>
                <div class="result-subjects">
                  ${(item.subjects || '').split(',').map(subject => 
                    `<span class="subject-badge">${subject.trim()}</span>`
                  ).join('')}
                </div>
              </div>
            `).join('')}
          </div>
        `;
        
        resultsContainer.innerHTML = resultsHtml;
      }
      
      function escapeHtml(s) {
        return (s || '').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]));
      }
      
      // Handle Enter key in search input
      document.getElementById('search-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          performAdvancedSearch();
        }
      });
      
      // Handle URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const urlQuery = urlParams.get('q');
      if (urlQuery) {
        document.getElementById('search-input').value = urlQuery;
        performAdvancedSearch();
      }
    </script>
  </body>
</html>
